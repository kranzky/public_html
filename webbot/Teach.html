<?
	$cookie="Ai01";
	if(!isset($question)) $question="#G";
	else if($user==1) $question=strtr($question,"[]()|:#","       ");
	$newuser=0;
	if(!isset($sessionid)) $newuser=1;
	if(!isset($sessionid)) $sessionid=0;
	$action_name[] = "unable to respond";
	$action_name[] = "go back one page";
	$action_name[] = "view the help page";
	$action_name[] = "email the page author";
	$action_name[] = "go to the home page";
	$action_name[] = "perform a search";
	function chatserv_encode($question,$sessionid)
	{
		global $cookie;
		return sprintf("%s%04d:%s\n",$cookie,$sessionid,$question);
	}
	function chatserv_decode($string,&$question,&$sessionid)
	{
		global $cookie;
		if(strcmp(substr($string,0,4),$cookie)!=0) return 0;
		$sessionid=intval(substr($string,4,4));
		if($sessionid==0) return 0;
		$question=substr($string,9);
		return 1;
	}
?>
<DOCTYPE HTML PUBLIC "-//Netscape Comm. Corp.//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Jason Hutchens: teach webbot</TITLE>
<LINK REL="StyleSheet" HREF="style/ai.css" TYPE="text/css" MEDIA="screen">
<LINK REV="Made" HREF="mailto:hutch@tmbg.org">
</HEAD>
<BODY>
<H1><A HREF="">Jason Hutchens</A>: teach webbot</H1>
<?
	/*
	$fp=fsockopen("10.111.222.113",6666,&$errno,&$errstr,10);
	*/
	$fp=fsockopen("localhost",6666,&$errno,&$errstr,10);
	if(!$fp)
	{
		exec("/home/hutch/bin/spawn /home/hutch/bin/chatserv &");
		echo("<P>(spawned a new server)</P>");
		sleep(1);
		/*
		$fp=fsockopen("10.111.222.113",6666,&$errno,&$errstr,10);
		*/
		$fp=fsockopen("localhost",6666,&$errno,&$errstr,10);
	}
	if(!$fp)
	{
?>
<H2>WebBot is Asleep</H2>
<P>Unfortunately the WebBot server is currently unavailable, which means that
you're unable to teach WebBot at the moment.  Please try again in a few moments.
The error given by the server was
"<?echo "$errstr ($errno)";?>".</P>
<?
	}
	else
	{
?>
<?
		$string=chatserv_encode($question,$sessionid);
		fputs($fp,$string);
		$string=fgets($fp,1024);
		fclose($fp);
		if(!chatserv_decode($string,$answer,$sessionid))
		{
?>
<H2>WebBot Response Error</H2>
<P>Unfortunately the response given by WebBot was not valid.  This is a serious
error; please send an email to me which contains the following message: An
invalid response of "<? echo "$string";?>" was sent by the WebBot server.</P>
<?
		}
		else
		{
?>
<H2>WebBot Output</H2>
<?
	/* PHP >= 4.0.1
	list($response,$message,$mutual[],$mutual[],$mutual[],$mutual[],$mutual[],$mutual[])=sscanf($answer,"%s (%s)[%f][%f][%f][%f][%f][%f]");
	*/
	$stimulus=strtok($answer,"|");
	$response=strtok("(");
	$message=strtok(")");
	for($i=0; $i<6; $i++)
	{
		strtok("[");
		$tok=strtok("]");
		$mutual[$i]="N\A";
		if($tok) $mutual[$i]=$tok;
	}
?>
<P>Your stimulus: "<? echo $stimulus; ?>".</P>
<P>WebBot response: "<? echo $response; ?>".</P>
<P>WebBot message: <? echo $message; ?></P>
<TABLE>
<TR><TH>Strength</TH><TH>Response</TH></TR>
<?
for($i=0; $i<6; $i++)
{
?>
<TR><TD><? echo $mutual[$i]; ?></TD><TD><? echo $action_name[$i]; ?></TD></TR>
<?
}
?>
</TABLE>
<FORM METHOD="Post" ACTION="Teach.html">
<INPUT SIZE="50" NAME="question">
<INPUT TYPE="Hidden" NAME="sessionid" VALUE="<? echo $sessionid; ?>">
<?
if($newuser==1)
{
?>
<INPUT TYPE="Submit" VALUE="Stimulate">
<?
}
else
{
?>
<INPUT TYPE="Submit" VALUE="Stimulate (and accept previous response)">
<?
}
?>
<INPUT TYPE="Hidden" NAME="user" VALUE="1">
</FORM>
<?
if($newuser==0)
{
?>
<FORM METHOD="Post" ACTION="Teach.html">
<INPUT TYPE="Hidden" NAME="question" VALUE="#P">
<INPUT TYPE="Hidden" NAME="sessionid" VALUE="<? echo $sessionid; ?>">
<INPUT TYPE="Hidden" NAME="user" VALUE="0">
<INPUT TYPE="Submit" VALUE="Punish">
</FORM>
<FORM METHOD="Post" ACTION="Teach.html">
<INPUT TYPE="Hidden" NAME="question" VALUE="#R">
<INPUT TYPE="Hidden" NAME="sessionid" VALUE="<? echo $sessionid; ?>">
<INPUT TYPE="Hidden" NAME="user" VALUE="0">
<INPUT TYPE="Submit" VALUE="Reward">
</FORM>
<FORM METHOD="Post" ACTION="Teach.html">
<SELECT NAME="question">
<?
for($i=0; $i<6; $i++)
{
?>
<OPTION VALUE="#<? echo $i; ?>"><? echo $action_name[$i]; ?></OPTION>
<?
}
?>
</SELECT>
<INPUT TYPE="Hidden" NAME="sessionid" VALUE="<? echo $sessionid; ?>">
<INPUT TYPE="Hidden" NAME="user" VALUE="0">
<INPUT TYPE="Submit" VALUE="Shape">
</FORM>
<?
}
}
}
?>
<P>[ <A HREF="Index.html">Home</A> |
<A HREF="Guide.html">Guide</A> |
<A HREF="How.html">How</A> |
<A HREF="Example.html">Example</A> |
<A HREF="mailto:hutch@tmbg.org">Email</A> |
<A HREF="report.pdf">Report</A> |
<A HREF="design.pdf">Design</A> |
<A HREF="Changes.html">Changes</A> ]</P>
</BODY>
</HTML>
