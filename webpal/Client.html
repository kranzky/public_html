<!-- Copyright (C) 2000 Artificial Intelligence NV -->
<?
	$cookie="Ai02";
	if(!isset($question)) $question="#G";
	else $question=strtr($question,"[]()|:#","       ");
	$newuser=0;
	if(!isset($sessionid)) $newuser=1;
	if(!isset($sessionid)) $sessionid=0;
	function chatserv_encode($question,$sessionid)
	{
		global $cookie;
		return sprintf("%s%04d:%s\n",$cookie,$sessionid,$question);
	}
	function chatserv_decode($string,&$question,&$sessionid)
	{
		global $cookie;
		if(strcmp(substr($string,0,4),$cookie)!=0) return 0;
		$sessionid=intval(substr($string,4,4));
		if($sessionid==0) return 0;
		$question=substr($string,9);
		return 1;
	}
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Client</TITLE>
<LINK REV="Made" HREF="mailto:hutch@tmbg.org">
<LINK REL="StyleSheet" HREF="style/interface.css" TYPE="text/css" MEDIA="screen">
<SCRIPT TYPE="text/javascript" SRC="script/webpal_callback.js"></SCRIPT>
</HEAD>
<BODY>
<?
	$fp=fsockopen("10.111.222.113",7777,&$errno,&$errstr,10);
	if(!$fp)
	{
		exec("/home/hutch/bin/spawn /home/hutch/bin/brainserv &");
		sleep(1);
		$fp=fsockopen("10.111.222.113",7777,&$errno,&$errstr,10);
	}
	if(!$fp)
	{
?>
<P ID="response"><ACTION>error:Unfortunately the ChatBot server is
currently unavailable, which means that you're unable to talk to ChatBot at
the moment.  Please try again in a few moments.  The error given by the server
was "<?echo "$errstr ($errno)";?>".</ACTION></P>
<?
	}
	else
	{
		$string=chatserv_encode($question,$sessionid);
		fputs($fp,$string);
		$string=fgets($fp,1024);
		fclose($fp);
		if(!chatserv_decode($string,$answer,$sessionid))
		{
?>
<P ID="response"><ACTION>error:Unfortunately the response given by
ChatBot was not valid.  This is a serious error; please send an email to me
which contains the following message: An invalid response of
"<? echo "$string";?>" was sent by the ChatBot server.</ACTION></P>
<?
		}
		else
		{
?>
<P ID="response"><? echo $answer; ?></P>
<?
		}
	}
?>
<FORM METHOD="Post" ACTION="Client.html" NAME="query">
<INPUT SIZE="50" NAME="question">
<INPUT TYPE="Hidden" NAME="sessionid" VALUE="<? echo $sessionid; ?>">
<INPUT TYPE="Hidden" NAME="user" VALUE="1">
</FORM>
</BODY>
</HTML>
<!-- Copyright (C) 2000 Artificial Intelligence NV -->
